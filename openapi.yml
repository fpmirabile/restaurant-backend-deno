swagger: "2.0"
info:
  version: "1.0.0"
  title: "Morfando Inc."
  contact:
    email: "fpmirabile@gmail.com"
host: "morfandoinc-demo.fly.dev/"
tags:
- name: "Auth"
  description: "JWT authentication"
- name: "Users"
  description: "User entity"
- name: "Restaurant"
  description: "Restaurant entity"
- name: "Menu"
  description: "Menu entity"
- name: "Food"
  description: "The food inside a menu"
schemes:
- "https"
securityDefinitions:
  BearerAuth:
    type: apiKey
    in: header
    name: Authorization
paths:
  /login:
    post:
      tags:
      - "Auth"
      summary: "User login through credentials"
      operationId: "login"
      consumes:
      - "application/json"
      produces:
      - "application/json"
      parameters:
      - in: "body"
        name: "body"
        required: true
        schema:
          $ref: "#/definitions/LoginCredential"
      responses:
        "200":
          description: "successful operation"
          schema:
            $ref: "#/definitions/AuthToken"
        "400":
          description: "Invalid request"
        "401":
          description: "Unauthorized"
  /login/sso:
    post:
      tags:
      - "Auth"
      summary: "User login through SSO"
      operationId: "login"
      consumes:
      - "application/json"
      produces:
      - "application/json"
      parameters:
      - in: "body"
        name: "body"
        required: true
        schema:
          $ref: "#/definitions/LoginSSO"
      responses:
        "200":
          description: "successful operation"
          schema:
            $ref: "#/definitions/AuthToken"
        "400":
          description: "Invalid request"
        "401":
          description: "Unauthorized"
  /register:
    post:
      tags:
      - "Auth"
      summary: "Register new restaurant owner"
      operationId: "register"
      produces:
      - "application/json"
      parameters:
      - in: "body"
        name: "body"
        required: true
        schema:
          $ref: "#/definitions/UserRegistration"
      responses:
        "200":
          description: "successful operation"
          schema:
            $ref: "#/definitions/UserModel"
        "400":
          description: "Invalid request"
        "500":
          description: "Something went wrong."
  /me:
    get:
      tags:
      - "Users"
      summary: "Get user information"
      security:
        - BearerAuth: []
      description: "Get current user information from the database"
      operationId: "getMe"
      produces:
      - "application/json"
      responses:
        "200":
          description: "successful operation"
          schema:
            $ref: "#/definitions/UserModel"
        "401":
          description: "Unauthorized user"
        "500":
          description: "Something went wrong."
  /likes:
    get:
      tags:
      - "Users"
      summary: "Get user's likes"
      security:
        - BearerAuth: []
      description: "Get all restaurant likes from current user"
      operationId: "getUserLikes"
      produces:
      - "application/json"
      responses:
        "200":
          description: "successful operation"
          schema:
            $ref: "#/definitions/UserLikes"
        "401":
          description: "Unauthorized user"
        "500":
          description: "Something went wrong."
    post:
      tags:
      - "Users"
      summary: "Adds a new like"
      security:
        - BearerAuth: []
      operationId: "savesNewLike"
      produces:
      - "application/json"
      responses:
        "200":
          description: "successful operation"
        "400":
          description: "Invalid request"
        "500":
          description: "Something went wrong."
  /likes/{likeId}:
    delete:
      tags:
      - "Users"  
      summary: Reemoves a like by id
      security:
        - BearerAuth: []
      description: "Delete a like by Id"
      operationId: "removeUserLike"
      produces:
      - "application/json"
      parameters:
      - name: "likeId"
        in: "path"
        description: "Id of the like"
        required: true
        type: "integer"
        format: "int64"
      responses:
        "204":
          description: "successful operation"
        "401":
          description: "Unauthorized user"
        "404":
          description: "Like not found"
  /restaurants:
    get:
      tags:
      - "Restaurant"
      summary: "Get all restaurants"
      security:
        - BearerAuth: []
      description: "Get list of my (owner) restaurants."
      operationId: "getRestaurantList"
      produces:
      - "application/json"
      responses:
        "200":
          description: "successful operation"
          schema:
            type: "array"
            items:
              $ref: "#/definitions/RestaurantModel"
        "401":
          description: "Unauthorized user"
        "403":
          description: "Forbidden"
    post:
      tags:
      - "Restaurant"
      summary: "Saves a new restaraunt, called by restaurant owner."
      security:
        - BearerAuth: []
      description: "Saves a new restaurant entity on the db, called only by the restaurant owner user type."
      operationId: "saveRestaurant"
      produces:
      - "application/json"
      parameters:
      - in: "body"
        name: "body"
        required: true
        schema:
          $ref: "#/definitions/NewRestaurantModel"
      responses:
        "200":
          description: "successful operation"
          schema:
            $ref: "#/definitions/RestaurantModel"
        "401":
          description: "Unauthorized user"
  /restaurants/{restaurantId}:
    get:
      tags:
      - "Restaurant"
      summary: "Get restaurant by Id"
      security:
        - BearerAuth: []
      description: "Get a restaurant by id, called only by owner of the restaurant"
      operationId: "getRestaurantById"
      produces:
      - "application/json"
      parameters:
      - name: "restaurantId"
        in: "path"
        description: "ID the restaurant return"
        required: true
        type: "integer"
        format: "int64"
      responses:
        "200":
          description: "successful operation"
          schema:
              $ref: "#/definitions/RestaurantModel"
        "401":
          description: "Unauthorized user"
        "404":
          description: "Restaurant not found"
    put:
      tags:
      - "Restaurant"
      summary: "Update restaurant by restaurantId"
      security:
        - BearerAuth: []
      description: "Updates a restaurant by given restaurantId, called by owner only."
      operationId: "updateRestaurant"
      produces:
      - "application/json"
      parameters:
      - name: "restaurantId"
        in: "path"
        description: "ID of the restaurant to return"
        required: true
        type: "integer"
        format: "int64"
      - in: "body"
        name: "body"
        required: true
        schema:
          $ref: "#/definitions/NewRestaurantModel"
      responses:
        "200":
          description: "successful operation"
          schema:
            $ref: "#/definitions/RestaurantModel"
        "401":
          description: "Unauthorized user"
        "404":
          description: "Restaurant not found"
    delete:
      tags:
      - "Restaurant"  
      summary: Delete a restaurant by restaurantId
      security:
        - BearerAuth: []
      description: "Delete a restaurant by Id, called by owner only."
      operationId: "deleteRestaurant"
      produces:
      - "application/json"
      parameters:
      - name: "restaurantId"
        in: "path"
        description: "ID of the restaurant to return"
        required: true
        type: "integer"
        format: "int64"
      responses:
        "204":
          description: "successful operation"
        "401":
          description: "Unauthorized user"
        "404":
          description: "Restaurant not found"
  /restaurants/{restaurantId}/menus:
    get:
      tags:
      - "Menu"  
      summary: "Gets all restaurant menues"
      security:
        - BearerAuth: []
      description: "Gets a specific restaurant menues, called by owner only."
      operationId: "getAllMenues"
      produces:
      - "application/json"
      parameters:
      - name: "restaurantId"
        in: "path"
        description: "ID of the restaurant"
        required: true
        type: "integer"
        format: "int64"
      responses:
        "200":
          description: "successful operation"
          schema:
            type: "array"
            items:
             $ref: "#/definitions/MenuModel"
        "401":
          description: "Unauthorized user"
    post:
      tags:
      - "Menu"
      summary: "Saves a new menu for a specific restaurant, called by restaurant owner."
      security:
        - BearerAuth: []
      description: "Saves a new menu for a restaurant by given id, called only by the restaurant owner."
      operationId: "saveMenu"
      produces:
      - "application/json"
      parameters:
      - name: "restaurantId"
        in: "path"
        description: "ID of the restaurant"
        required: true
        type: "integer"
        format: "int64"
      - in: "body"
        name: "body"
        required: true
        schema:
          $ref: "#/definitions/NewMenuModel"
      responses:
        "200":
          description: "successful operation"
          schema:
              $ref: "#/definitions/MenuModel"
        "401":
          description: "Unauthorized user"
  /restaurants/{restaurantId}/menus/{menuId}:
    get:
      tags:
      - "Menu"  
      summary: "Gets a restaurant menu by id"
      security:
        - BearerAuth: []
      description: "Gets a specific restaurant menu, called by owner only."
      operationId: "getMenuById"
      produces:
      - "application/json"
      parameters:
      - name: "restaurantId"
        in: "path"
        description: "ID of the restaurant"
        required: true
        type: "integer"
        format: "int64"
      - name: "menuId"
        in: "path"
        description: "ID of the menu"
        required: true
        type: "integer"
        format: "int64"
      responses:
        "200":
          description: "successful operation"
          schema:
              $ref: "#/definitions/MenuModel"
        "401":
          description: "Unauthorized user"
    put:
      tags:
      - "Menu"
      summary: "Updates a restaurant menu"
      security:
        - BearerAuth: []
      description: "Updates a restaurant menu by id, called by the owner."
      operationId: "updateMenu"
      produces:
      - "application/json"
      parameters:
      - name: "restaurantId"
        in: "path"
        description: "ID of the restaurant"
        required: true
        type: "integer"
        format: "int64"
      - name: "menuId"
        in: "path"
        description: "ID of menu"
        required: true
        type: "integer"
        format: "int64"
      - in: "body"
        name: "body"
        required: true
        schema:
          $ref: "#/definitions/NewMenuModel"
      responses:
        "200":
          description: "successful operation"
          schema:
            $ref: "#/definitions/MenuModel"
        "401":
          description: "Unauthorized user"
        "404":
          description: "Restaurant not found"
    delete:
      tags:
      - "Menu"  
      summary: Delete a menu from a restaurant
      security:
        - BearerAuth: []
      description: "Delete a menu from a restaurant by Id, called by owner."
      operationId: "deleteMenu"
      produces:
      - "application/json"
      parameters:
      - name: "restaurantId"
        in: "path"
        description: "ID of the restaurant"
        required: true
        type: "integer"
        format: "int64"
      - name: "menuId"
        in: "path"
        description: "ID of the menu"
        required: true
        type: "integer"
        format: "int64"
      responses:
        "204":
          description: "successful operation"
        "401":
          description: "Unauthorized user"
        "404":
          description: "Menu not found"
  /restaurants/{restaurantId}/menus/{menuId}/food:
    post:
      tags:
      - "Food"
      summary: "saves new food in a menu on a restaurant"
      security:
        - BearerAuth: []
      description: "Saves new food object into a menu for a restaurant by given ids"
      operationId: "saveFoodInMenu"
      produces:
      - "application/json"
      parameters:
      - name: "restaurantId"
        in: "path"
        description: "ID of the restaurant"
        required: true
        type: "integer"
        format: "int64"
      - name: "menuId"
        in: "path"
        description: "ID of the menu"
        required: true
        type: "integer"
        format: "int64"
      - in: "body"
        name: "body"
        required: true
        schema:
          $ref: "#/definitions/NewItemModel"
      responses:
        "200":
          description: "successful operation"
          schema:
              $ref: "#/definitions/ItemModel"
        "401":
          description: "Unauthorized user"
        "403":
          description: "Forbidden"
    get:
      tags:
      - "Food"  
      summary: "Gets all restaurant menues"
      security:
        - BearerAuth: []
      description: "Gets all restaurant food on a specific menu"
      operationId: "getAllFoodInMenu"
      produces:
      - "application/json"
      parameters:
      - name: "restaurantId"
        in: "path"
        description: "ID of the restaurant"
        required: true
        type: "integer"
        format: "int64"
      - name: "menuId"
        in: "path"
        description: "ID of the menu"
        required: true
        type: "integer"
        format: "int64"
      responses:
        "200":
          description: "successful operation"
          schema:
            type: "array"
            items:
             $ref: "#/definitions/ItemModel"
        "401":
          description: "Unauthorized user"
  /restaurants/{restaurantId}/menus/{menuId}/foods/{foodId}:
    get:
      tags:
      - "Food"  
      summary: "Gets specific food in a menu"
      security:
        - BearerAuth: []
      description: "Gets specific food in a menu"
      operationId: "getFood"
      produces:
      - "application/json"
      parameters:
      - name: "restaurantId"
        in: "path"
        description: "ID of the restaurant"
        required: true
        type: "integer"
        format: "int64"
      - name: "menuId"
        in: "path"
        description: "ID of the menu"
        required: true
        type: "integer"
        format: "int64"
      - name: "foodId"
        in: "path"
        description: "ID of the food"
        required: true
        type: "integer"
        format: "int64"
      responses:
        "200":
          description: "successful operation"
          schema:
            type: "array"
            items:
             $ref: "#/definitions/ItemModel"
        "401":
          description: "Unauthorized user"
    put:
      tags:
      - "Food"
      summary: "Updates food in a menu for a specific restaurant"
      security:
        - BearerAuth: []
      description: "Updates food in a menu for a restaurant"
      operationId: "updateFoodInMenu"
      produces:
      - "application/json"
      parameters:
      - name: "restaurantId"
        in: "path"
        description: "ID of the restaurant"
        required: true
        type: "integer"
        format: "int64"
      - name: "menuId"
        in: "path"
        description: "ID of the menu"
        required: true
        type: "integer"
        format: "int64"
      - name: "foodId"
        in: "path"
        description: "ID of the food"
        required: true
        type: "integer"
        format: "int64"
      - in: "body"
        name: "body"
        required: true
        schema:
          $ref: "#/definitions/NewItemModel"
      responses:
        "200":
          description: "successful operation"
          schema:
              $ref: "#/definitions/ItemModel"
        "401":
          description: "Unauthorized user"
        "403":
          description: "Forbidden"
    delete:
      tags:
      - "Food"
      summary: "Removes food for a menu"
      security:
        - BearerAuth: []
      description: "Removes food for a menu"
      operationId: "removeFood"
      produces:
      - "application/json"
      parameters:
      - name: "restaurantId"
        in: "path"
        description: "ID of the restaurant"
        required: true
        type: "integer"
        format: "int64"
      - name: "menuId"
        in: "path"
        description: "ID of the menu"
        required: true
        type: "integer"
        format: "int64"
      - name: "foodId"
        in: "path"
        description: "ID of the food"
        required: true
        type: "integer"
        format: "int64"
      responses:
        "200":
          description: "successful operation"
        "401":
          description: "Unauthorized user"
        "403":
          description: "Forbidden"
  /restaurants/near:
    get:
      tags:
      - "Restaurant"
      summary: "Get restaurants by user's position"
      security:
        - BearerAuth: []
      description: "Get a restaurant by a given position."
      operationId: "getRestaurantByPosition"
      produces:
      - "application/json"
      parameters:
      - in: query
        name: lat
        type: string
        description: latitude number of the current position
      - in: query
        name: lon
        type: string
        description: longitude number of the current position
      responses:
        "200":
          description: "successful operation"
          schema:
            type: "array"
            items:
              $ref: "#/definitions/RestaurantModel"
        "401":
          description: "Unauthorized user"
definitions:
  LoginCredential:
    type: "object"
    properties:
      email:
        type: "string"
        format: "string"
      password:
        type: "string"
        format: "password"
  LoginSSO:
    type: "object"
    properties:
      idToken:
        type: "string"
        format: "password"
      email:
        type: "string"
        format: "string"
  AuthToken:
    type: "object"
    properties:
      access_token:
        type: "string"
        format: "string"
      refresh_token:
        type: "string"
        format: "string"
  UserRegistration:
    type: "object"
    properties:
      name:
        type: "string"
        format: "string"
      email:
        type: "string"
        format: "string"
      password:
        type: "string"
        format: "password"
      confirmPassword: 
        type: "string"
        format: "password"
  UserUpdateData:
    type: "object"
    properties:
      name:
        type: "string"
        format: "string"
      email:
        type: "string"
        format: "string"
  UserModel:
    type: "object"
    properties:
      id:
        type: "integer"
        format: "int32"
      name:
        type: "string"
        format: "string"
      email:
        type: "string"
        format: "string"
      roles:
        type: "string"
        format: "string"
      is_active:
        type: "boolean"
      createdAt:
        type: "string"
        format: "date-time"
      updatedAt:
        type: "string"
        format: "date-time"
  NewRestaurantModel:
    type: "object"
    properties:
      name:
        type: "string"
        format: "string"
      street:
        type: "string"
        format: "string"
      streetNumber:
        type: "string"
        format: "string"
      neighborhood:
        type: "string"
        format: "string"
      place:
        type: "string"
        format: "string"
      state:
        type: "string"
        format: "string"
      lat:
        type: "number"
        format: "float"
      lon:
        type: "number"
        format: "float"
      openDays:
        type: "array"
        items:
          type: "string"
      images:
        type: "array"
        items:
          type: "string"
      openTime:
        type: "string"
        format: "string"
      closeTime: 
        type: "string"
        format: "string"
  RestaurantModel:
    type: "object"
    properties:
      id:
        type: "integer"
        format: "int32"
      name:
        type: "string"
        format: "string"
      address:
        type: "string"
        format: "string"
      ownerId:
        type: "integer"
        format: "int32"
      lat:
        type: "number"
        format: "float"
      lon:
        type: "number"
        format: "float"
      createdAt:
        type: "string"
        format: "date-time"
      updatedAt:
        type: "string"
        format: "date-time"
  NewMenuModel:
    type: "object"
    properties:
      name:
        type: "string"
        format: "string"
  MenuModel:
    type: "object"
    properties:
      id:
        type: "integer"
        format: "int32"
      categories:
        type: "array"
        items:
          $ref: '#/definitions/CategoryModel'
  NewCategoryModel:
    type: "object"
    properties:
      name:
        type: "string"
        format: "string"
  CategoryModel:
    type: "object"
    properties:
      id:
        type: "integer"
        format: "int32"
      name:
        type: "string"
        format: "string"
      items:
        type: "array"
        items:
          $ref: '#/definitions/ItemModel'
  NewItemModel:
    type: "object"
    properties:
      name:
        type: "string"
        format: "string"
      price: 
        type: "number"
        format: "float"
      images:
        type: "array"
        items:
          type: "string"
      ingredients:
        type: "array"
        items:
          type: "string"
      suitableFor:
        type: "string"
        format: "string"
  ItemModel:
    type: "object"
    properties:
      id:
        type: "integer"
        format: "int32"
      name:
        type: "string"
        format: "string"
      price: 
        type: "number"
        format: "float"
      images:
        type: "array"
        items:
          type: "string"
      ingredients:
        type: "array"
        items:
          type: "string"
      suitableFor:
        type: "string"
        format: "string"


externalDocs:
  description: "Swagger documentation"
  url: "http://swagger.io"